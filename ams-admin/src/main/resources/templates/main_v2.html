<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>统计</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <link href="../static/css/font-awesome.min.css" th:href="@{/css/font-awesome.min.css}" rel="stylesheet"/>
    <link href="../static/css/main/animate.min.css" th:href="@{/css/main/animate.min.css}" rel="stylesheet"/>
    <link href="../static/css/main/style.min862f.css" th:href="@{/css/main/style.min862f.css}" rel="stylesheet"/>
</head>

<body class="gray-bg">
<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-md-1-5">
            <div class="ibox float-e-margins">
                <div class="col-md-4" style="background-color:#fff;padding-left: 5px;">
                    <div class="img-box" style="width: 80px;height: 135px;">
                        <img src="../static/kucun1.png" th:src="@{/kucun1.png}" style="margin-top: 27px;">
                    </div>
                </div>
                <div class="col-md-8" style="background-color:#fff;height: 135px;">
                    <h1 style="color: #0e9aef;">1200件</h1>
                    <h1 class="no-margins" style="padding-bottom: 10px;">&yen;7,254,203</h1>
                    <small>总资产数量</small>
                </div>
            </div>
        </div>
        <div class="col-md-1-5">
            <div class="ibox float-e-margins">
                <div class="col-md-4" style="background-color:#fff;padding-left: 5px;">
                    <div class="img-box" style="width: 80px;height: 135px;">
                        <img src="../static/xianzhi.png" th:src="@{/xianzhi.png}" style="margin-top: 27px;">
                    </div>
                </div>
                <div class="col-md-8" style="background-color:#fff;height: 135px;">
                    <h1 style="color: #0e9aef;">2200件</h1>
                    <h1 class="no-margins" style="padding-bottom: 10px;">&yen;254,203</h1>
                    <small>闲置资产数量</small>
                </div>
            </div>
        </div>
        <div class="col-md-1-5">
            <div class="ibox float-e-margins">
                <div class="col-md-4" style="background-color:#fff;padding-left: 5px;">
                    <div class="img-box" style="width: 80px;height: 135px;">
                        <img src="../static/shiyong.png" th:src="@{/shiyong.png}" style="margin-top: 27px;">
                    </div>
                </div>
                <div class="col-md-8" style="background-color:#fff;height: 135px;">
                    <h1 style="color: #0e9aef;">1200件</h1>
                    <h1 class="no-margins" style="padding-bottom: 10px;">&yen;554,203</h1>
                    <small>使用资产数量</small>
                </div>
            </div>
        </div>
        <div class="col-md-1-5">
            <div class="ibox float-e-margins">
                <div class="col-md-4" style="background-color:#fff;padding-left: 5px;">
                    <div class="img-box" style="width: 80px;height: 135px;">
                        <img src="../static/baofei.png" th:src="@{/baofei.png}" style="margin-top: 27px;">
                    </div>
                </div>
                <div class="col-md-8" style="background-color:#fff;height: 135px;">
                    <h1 style="color: #0e9aef;">1200件</h1>
                    <h1 class="no-margins" style="padding-bottom: 10px;">&yen;254,203</h1>
                    <small>报废资产数量</small>
                </div>
            </div>
        </div>
        <div class="col-md-1-5">
            <div class="ibox float-e-margins">
                <div class="col-md-4" style="background-color:#fff;padding-left: 5px;">
                    <div class="img-box" style="width: 80px;height: 135px;">
                        <img src="../static/chuzhi.png" th:src="@{/chuzhi.png}" style="margin-top: 27px;">
                    </div>
                </div>
                <div class="col-md-8" style="background-color:#fff;height: 135px;">
                    <h1 style="color: #0e9aef;">1200件</h1>
                    <h1 class="no-margins" style="padding-bottom: 10px;">&yen;7,254,203</h1>
                    <small>处置资产数量</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row" style="margin-top: 15px;">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>待办列表</h5>
                    <div class="pull-right">
                        <div class="btn-group">
                            <button type="button" class="btn btn-xs btn-white" onclick="moreTask()">更多
                            </button>
                        </div>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-12 select-table table-striped">
                            <table id="bootstrap-table"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <div class="col-sm-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <div class="echarts" id="echarts-pie-chart"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <div class="echarts" id="echarts-bar-chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/ajax/libs/flot/jquery.flot.js}"></script>


<th:block th:include="include :: sparkline-js"/>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: layout-latest-js"/>
<th:block th:include="include :: echarts-js"/>

<script type="text/javascript">
    var prefix2 = "/system/mainTable";

    $(function () {
        queryUserList();
    });

    function queryUserList() {
        var options = {
            url: prefix2 + "/todoList",
            approveUrl: prefix2 + "/examineOK/{orderNum}/{userId}",
            rejectUrl: prefix2 + "/examineReject/{orderNum}/{userId}",
            myExamineUrl: prefix2 + "/myExamine",
            moreInfoUrl: prefix2 + "/moreInfo",
            showSearch: false,
            showRefresh: false,
            showToggle: false,
            showColumns: false,
            sortName: "createTime",
            sortOrder: "desc",
            modalName: "待办",
            columns: [{
                field: 'seqNo',
                title: '序号'
            },
                {
                    field: 'type',
                    title: '类型',
                    align: 'center'
                },
                {
                    field: 'orderNum',
                    title: '单号',
                    sortable: true,
                    align: 'center'
                },
                {
                    field: 'userName',
                    title: '操作人',
                    align: 'center'
                },
                {
                    field: 'userId',
                    title: '申请人Id',
                    visible: false
                },
                {
                    field: 'parentName',
                    title: '所在学院',
                    align: 'center'
                },
                {
                    field: 'date',
                    title: '操作时间',
                    align: 'center'
                },
                {
                    title: '操作',
                    align: 'center',
                    formatter: function (value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-success btn-xs " href="javascript:void(0)" onclick="$.operate.examineOK(\'' + row.orderNum + '\',\'' + row.userId + '\')"><i class="fa fa-check"></i>同意</a> ');
                        actions.push('<a class="btn btn-success btn-xs " href="javascript:void(0)" onclick="$.operate.examineReject(\'' + row.orderNum + '\',\'' + row.userId + '\')"><i class="fa fa-close"></i>驳回</a> ');
                        return actions.join('');
                    }
                }]
        };
        $.table.init(options);
    }

    function moreTask() {
        //主页面更多按钮
        table.set();
        var url = table.options.moreInfoUrl;
        $.modal.openTab("更多待办", url);
    }

    //图表部分JavaScript
    var prefix = "/assets/chart";
    //柱状图
    var barChart = echarts.init(document.getElementById("echarts-bar-chart"));
    getData();

    function getData() {
        $.ajax({
            url: prefix + "/ruKu",
            type: 'post',
            dataType: "JSON",
            success: function (data) {
                var list = data;
                var assetsName = [];
                var totalMoney = [];
                var assetsCount = [];

                for (var i = 0; i < list.length; i++) {
                    assetsName.push(list[i].assetsName);
                    totalMoney.push(list[i].totalMoney);
                    assetsCount.push(list[i].assetsCount);
                }

                var option = drawBar(assetsName, totalMoney, assetsCount);
                if (option && typeof option === "object") {
                    barChart.setOption(option);
                    window.onresize = barChart.resize;

                }
            }
        })

    }

    function drawBar(assetsName, totalMoney, assetsCount) {

        var baroption = {
            title: {
                text: '入库报表'
            },
            tooltip: {
                trigger: 'axis'
            },
            //显示工具栏
            toolbox: {
                show: true,
                showTitle: true,
                top: 'auto',
                feature: {
                    dataView: {//数据视图
                        show: true
                    },
                    dataZoom: {
                        show: true
                    },
                    restore: {
                        show: true
                    },
                    magicType: {
                        type: ['line', 'bar']
                    },
                    saveAsImage: {
                        show: true
                    }

                }
            },
            legend: {
                data: ['金额', '数量']
            },
            grid: {
                x: 48,
                x2: 48
            },
            calculable: true,
            xAxis: [
                {
                    type: 'category',
                    data: assetsName,
                    axisLabel: {
                        interval: 0,
                        rotate: 20
                    },
                }

            ],

            yAxis: [
                {
                    type: 'value',
                    axisLabel: {
                        show: true,
                        interval: 0
                    },
                }
            ],
            series: [
                {
                    name: '金额',
                    type: 'bar',
                    data: totalMoney,
                    markPoint: {
                        data: [
                            {type: 'max', name: '最大值'},
                            {type: 'min', name: '最小值'}
                        ]
                    },
                    markLine: {
                        data: [
                            {type: 'average', name: '平均值'}
                        ]
                    }
                },
                {
                    name: '数量',
                    type: 'bar',
                    data: assetsCount,
                    markPoint: {
                        data: [
                            {type: 'max', name: '最大值'},
                            {type: 'min', name: '最小值'}
                        ]
                    },
                    markLine: {
                        data: [
                            {type: 'average', name: '平均值'}
                        ]
                    }
                }
            ]
        };
        return baroption;

    }

    //饼图
    var pieChart = echarts.init(document.getElementById("echarts-pie-chart"));
    getData2();

    function getData2() {
        $.ajax({
            url: prefix + "/ziChan",
            type: 'post',
            dataType: "JSON",
            success: function (data) {
                var list = data;
                var normalCount = 0;
                var examineCount = 0;
                var usingCount = 0;
                var repairingCount = 0;
                var scrappedCount = 0;
                var disableCount = 0;

                for (var i = 0; i < list.length; i++) {
                    switch (list[i].useStatus) {
                        case "0":
                            normalCount = list[i].totalNum;
                            break;
                        case "1":
                            examineCount = list[i].totalNum;
                            break;
                        case "2":
                            usingCount = list[i].totalNum;
                            break;
                        case "3":
                            repairingCount = list[i].totalNum;
                            break;
                        case "4":
                            scrappedCount = list[i].totalNum;
                            break;
                        case "5":
                            disableCount = list[i].totalNum;
                            break;
                        default:
                            break;
                    }
                }
                var option = drawPie(normalCount, examineCount, usingCount, repairingCount, scrappedCount, disableCount);
                if (option && typeof option === "object") {
                    pieChart.setOption(option);
                    $(window).resize(pieChart.resize);

                }
            }
        })

    }

    function drawPie(normalCount, examineCount, usingCount, repairingCount, scrappedCount, disableCount) {

        var pieoption = {
            title: {
                text: '库存资产状态统计',
                x: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                x: 'left',
                data: ['闲置', '审核中', '在用', '维修中', '待报废', '停用']
            },
            calculable: true,
            series: [
                {
                    name: '资产状态',
                    type: 'pie',
                    radius: '55%',
                    center: ['50%', '60%'],
                    data: [
                        {value: normalCount, name: '闲置'},
                        {value: examineCount, name: '审核中'},
                        {value: usingCount, name: '在用'},
                        {value: repairingCount, name: '维修中'},
                        {value: scrappedCount, name: '待报废'},
                        {value: disableCount, name: '停用'}
                    ]
                }
            ]
        };

        return pieoption;

    }
</script>
<style type="text/css">
    .col-xs-1-5,
    .col-sm-1-5,
    .col-md-1-5,
    .col-lg-1-5 {
        position: relative;
        min-height: 1px;
        margin-right: 5px;
        margin-left: 5px;

    }

    .col-xs-1-5 {
        width: 18%;
        float: left;
    }

    @media (min-width: 768px) {
        .col-sm-1-5 {
            width: 18%;
            float: left;
        }
    }

    @media (min-width: 992px) {
        .col-md-1-5 {
            width: 19%;
            float: left;
        }
    }

    @media (min-width: 1200px) {
        .col-lg-1-5 {
            width: 18%;
            float: left;
        }
    }
</style>
</body>
</html>
